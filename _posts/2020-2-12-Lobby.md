---
layout: post
title: Lobby
img: images/placeholder2.png
forward: Gameplay
back: Rooms
tag: Creating a multiplayer game like Jackbox
---

Players are now able to join a room on the server. Let's make a lobby where players can join and wait for the game to start.

This tutorial continues with the code from the previous part. You can get the finished project from the last part [here](https://github.com/RubenBimmel/MultiplayerGameTutorial/tree/master/05-Rooms).

## Showing players on the game screen

Let's start by adding newly joined players to the shared screen. First we need to send the player information to the host. Add the following code to the addPlayer funciton in our `gamemanager.js`.

```js
addPlayer(socket, name) {
    var player = {
        id: socket.id,
        name: name
    };
    this.players.push (player);
    socket.join(this.id);
    this.host.emit('addPlayer', player);
}
```

Now let's listen to this event in `game.js` and add a new player to the players panel.

```js
var playerPanel = document.getElementById("players");

socket.on('addPlayer', function(p) {
    var player = document.createElement('div');
    player.classList = 'player';
    player.innerHTML = `<h2>${p.name}</h2>`;
    playerPanel.appendChild(player);
});
```

Let's also add a players object to `game.js` so that we can access our players by their ID.

```js
var playerPanel = document.getElementById("players");
var players = {};

socket.on('addPlayer', function(p) {
    var player = document.createElement('div');
    player.classList = 'player';
    player.innerHTML = `<h2>${p.name}</h2>`;
    playerPanel.appendChild(player);
    players[p.id] = player;
});
```

Now we can see new players joining the game on our screen.

## Waiting for all players to be ready

We need some way to know when all players joined and are ready to play the game. To do this we can use a ready button and start the game when all joined players are ready. Let's start by creating a ready state on the client side. Add the following lines of code to `controller.js`.

```js
var readyButton = document.getElementById('ready');
var ready = false;

readyButton.onclick = function() {
    ready = !ready;
    readyButton.classList = ready ? 'ready' : '';
}
```

Now we can toggle our ready state by pressing the button. The button will turn green to indicate that we are ready. Let's also send this event to the server.

```js
readyButton.onclick = function() {
    ready = !ready;
    readyButton.classList = ready ? 'ready' : '';
    socket.emit('ready', ready);
}
```

We want to be able to see what players are ready on our game screen. So let's forward this ready event to our host. Add the following lines of code to our `gamemanager.js`.

```js
addPlayer(socket, name) {
    var player = {
        id: socket.id,
        name: name
    };
    this.players.push (player);
    socket.join(this.id);
    this.room.to(this.host).emit('addPlayer', player);

    socket.on('ready', (ready) => {
        player.ready = ready;
        this.room.to(this.host).emit('ready', player);
    });
}
```

Now we can mark ready players as active in `game.js`.

```js
socket.on('ready', function(p) {
    if (p.ready) players[p.id].classList.add('active');
    else players[p.id].classList.remove('active');
});
```

## Updating the gamestate

Now it's time to add a state to our game. We can initialise our game in the lobby state. Then when all players are ready we will update our game to the betting state. Add the following lines of code to our `gamemanager.js`.

```js
constructor(id) {
    this.id = id;
    this.players = [];
    this.state = "lobby";
}

setState(state) {
    this.state = state;
    this.room.emit('state', this.state);
}
```

Now inside our ready event we can check if there are any players left that are not ready. First let's check if there are actually two or more players in the room. Then if everyone is ready we can continue our game.

```js
socket.on('ready', (ready) => {
    player.ready = ready;
    this.room.to(this.host).emit('ready', player);

    if (this.players.length >= 2) {
        var unready = this.players.find(p => !p.ready);
        if (!unready) this.setState("betting");
    }
});
```

Finally, let's also update the states of our game ui in both our game screen and our controller screen so that we can see the change. Add the following lines of code to `game.js`.

```js
var gameUI = document.getElementById("state");

socket.on('state', function(state) {
    gameUI.classList = state;
})
```

And add the same code to `controller.js`.

```js
var gameUI = document.getElementById("state");

socket.on('state', function(state) {
    gameUI.classList = state;
})
```

[View code](https://github.com/RubenBimmel/MultiplayerGameTutorial/tree/master/06-Lobby)

## More possibilitie for our lobby

This is all we are going to do for our lobby in this tutorial. In the next and final part we will add the gameplay to our game.

There is still a lot we can add to our lobby. Try adding functionality to remove disconnected players from a game. And then reconnect them when they join the game again (hint: you can use local storage for this).